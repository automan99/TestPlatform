import{r as g,a as L,B as _e,c as I,o as U,b as e,w as a,E as be,a9 as ce,at as ge,au as ye,l as C,h as Ve,ad as we,ae as ke,a4 as Ce,a5 as Ee,$ as xe,k as i,t as D,j as Ue,F as h,m as G,d as H,q as J,ag as K,f as Re,g as $e,a2 as Te,a3 as Fe,ao as Le,ap as Q,y as S}from"./index-vTAAATWV.js";/* empty css                 *//* empty css                        *//* empty css                  *//* empty css                     *//* empty css               *//* empty css                *//* empty css                    *//* empty css                        *//* empty css                   *//* empty css               */import{r as f}from"./index-BRBj6Fej.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";const B={getList:s=>f.get("/environments",{params:s}),getDetail:s=>f.get(`/environments/${s}`),create:s=>f.post("/environments",s),update:(s,v)=>f.put(`/environments/${s}`,v),delete:s=>f.delete(`/environments/${s}`)},q={getList:s=>f.get("/environment-resources",{params:s}),getDetail:s=>f.get(`/environment-resources/${s}`),create:s=>f.post("/environment-resources",s),update:(s,v)=>f.put(`/environment-resources/${s}`,v),delete:s=>f.delete(`/environment-resources/${s}`),updateStatus:(s,v)=>f.put(`/environment-resources/${s}/status`,v)},Se={class:"environment-page"},Be={class:"page-header"},qe={class:"toolbar"},Ie={class:"toolbar"},je={__name:"Index",setup(s){const v=g("list"),R=g([]),j=g([]),y=g(!1),V=g(!1),z=g(),O=g(),E=L({keyword:"",env_type:""}),c=L({environment_id:null,status:""}),u=L({id:null,name:"",env_code:"",env_type:"testing",base_url:"",description:""}),o=L({id:null,environment_id:null,name:"",resource_type:"server",host:"",port:22,username:"",password:"",description:""}),W={name:[{required:!0,message:"请输入环境名称",trigger:"blur"}]},X={name:[{required:!0,message:"请输入资源名称",trigger:"blur"}],environment_id:[{required:!0,message:"请选择环境",trigger:"change"}]};function Y(n){return{dev:"info",testing:"warning",staging:"primary",production:"danger"}[n]||"info"}function Z(n){return{dev:"开发",testing:"测试",staging:"预发布",production:"生产"}[n]||n}function ee(n){return{online:"success",offline:"info",busy:"warning",error:"danger"}[n]||"info"}function le(n){return{online:"在线",offline:"离线",busy:"忙碌",error:"错误"}[n]||n}async function x(){var l;const n=await B.getList(E);R.value=((l=n.data)==null?void 0:l.items)||[]}async function w(){var l;const n=await q.getList(c);j.value=((l=n.data)==null?void 0:l.items)||[]}function te(){v.value==="resources"&&w()}function ae(){Object.assign(u,{id:null,name:"",env_code:"",env_type:"testing",base_url:"",description:""}),y.value=!0}function ne(n){Object.assign(u,n),y.value=!0}function oe(n){Q.confirm("确定要删除这个环境吗？","提示",{type:"warning"}).then(()=>B.delete(n.id)).then(()=>{S.success("删除成功"),x()})}function se(){z.value.validate(n=>{if(n){const l=u.id?B.update:B.create,d=u.id?u.id:u;l(d,u.id?null:u).then(()=>{S.success(u.id?"更新成功":"创建成功"),y.value=!1,x()})}})}function ue(n){v.value="resources",c.environment_id=n.id,w()}function re(){Object.assign(o,{id:null,environment_id:c.environment_id,name:"",resource_type:"server",host:"",port:22,username:"",password:"",description:""}),V.value=!0}function de(n){Object.assign(o,n),V.value=!0}function ie(n){Q.confirm("确定要删除这个资源吗？","提示",{type:"warning"}).then(()=>q.delete(n.id)).then(()=>{S.success("删除成功"),w()})}function pe(){O.value.validate(n=>{if(n){const l=o.id?q.update:q.create,d=o.id?o.id:o;l(d,o.id?null:o).then(()=>{S.success(o.id?"更新成功":"创建成功"),V.value=!1,w()})}})}return _e(()=>{x()}),(n,l)=>{const d=Ue,_=Ve,r=ke,k=we,p=Ee,$=xe,N=Ce,M=ye,me=ge,fe=be,m=$e,b=Fe,T=Te,A=Re,P=ce,ve=Le;return U(),I("div",Se,[e(fe,null,{header:a(()=>[C("div",Be,[l[23]||(l[23]=C("span",null,"测试环境管理",-1)),e(d,{type:"primary",icon:J(K),onClick:ae},{default:a(()=>[...l[22]||(l[22]=[i("新建环境",-1)])]),_:1},8,["icon"])])]),default:a(()=>[e(me,{modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=t=>v.value=t),onTabChange:te},{default:a(()=>[e(M,{label:"环境列表",name:"list"},{default:a(()=>[C("div",qe,[e(_,{modelValue:E.keyword,"onUpdate:modelValue":l[0]||(l[0]=t=>E.keyword=t),placeholder:"搜索环境",clearable:"",style:{width:"200px"},onChange:x},null,8,["modelValue"]),e(k,{modelValue:E.env_type,"onUpdate:modelValue":l[1]||(l[1]=t=>E.env_type=t),placeholder:"环境类型",clearable:"",onChange:x},{default:a(()=>[e(r,{label:"开发环境",value:"dev"}),e(r,{label:"测试环境",value:"testing"}),e(r,{label:"预发布环境",value:"staging"}),e(r,{label:"生产环境",value:"production"})]),_:1},8,["modelValue"]),l[24]||(l[24]=C("div",{style:{flex:"1"}},null,-1))]),e(N,{data:R.value,style:{width:"100%"}},{default:a(()=>[e(p,{prop:"env_code",label:"编码",width:"120"}),e(p,{prop:"name",label:"环境名称"}),e(p,{prop:"env_type",label:"类型",width:"120"},{default:a(({row:t})=>[e($,{type:Y(t.env_type)},{default:a(()=>[i(D(Z(t.env_type)),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"base_url",label:"基础URL","show-overflow-tooltip":""}),e(p,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[e($,{type:t.status==="active"?"success":"info"},{default:a(()=>[i(D(t.status==="active"?"正常":"停用"),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"resources_count",label:"资源数",width:"100"}),e(p,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[e(d,{type:"primary",link:"",size:"small",onClick:F=>ue(t)},{default:a(()=>[...l[25]||(l[25]=[i("资源",-1)])]),_:1},8,["onClick"]),e(d,{type:"primary",link:"",size:"small",onClick:F=>ne(t)},{default:a(()=>[...l[26]||(l[26]=[i("编辑",-1)])]),_:1},8,["onClick"]),e(d,{type:"danger",link:"",size:"small",onClick:F=>oe(t)},{default:a(()=>[...l[27]||(l[27]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(M,{label:"主机资源",name:"resources"},{default:a(()=>[C("div",Ie,[e(k,{modelValue:c.environment_id,"onUpdate:modelValue":l[2]||(l[2]=t=>c.environment_id=t),placeholder:"选择环境",clearable:"",onChange:w},{default:a(()=>[(U(!0),I(h,null,G(R.value,t=>(U(),H(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(k,{modelValue:c.status,"onUpdate:modelValue":l[3]||(l[3]=t=>c.status=t),placeholder:"状态",clearable:"",onChange:w},{default:a(()=>[e(r,{label:"在线",value:"online"}),e(r,{label:"离线",value:"offline"}),e(r,{label:"忙碌",value:"busy"})]),_:1},8,["modelValue"]),l[29]||(l[29]=C("div",{style:{flex:"1"}},null,-1)),e(d,{type:"primary",icon:J(K),onClick:re},{default:a(()=>[...l[28]||(l[28]=[i("新建资源",-1)])]),_:1},8,["icon"])]),e(N,{data:j.value,style:{width:"100%"}},{default:a(()=>[e(p,{prop:"name",label:"资源名称"}),e(p,{prop:"resource_type",label:"类型",width:"100"},{default:a(({row:t})=>[e($,null,{default:a(()=>[i(D(t.resource_type),1)]),_:2},1024)]),_:1}),e(p,{prop:"host",label:"主机"}),e(p,{prop:"port",label:"端口",width:"80"}),e(p,{prop:"os_type",label:"系统",width:"100"}),e(p,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[e($,{type:ee(t.status)},{default:a(()=>[i(D(le(t.status)),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[e(d,{type:"primary",link:"",size:"small",onClick:F=>de(t)},{default:a(()=>[...l[30]||(l[30]=[i("编辑",-1)])]),_:1},8,["onClick"]),e(d,{type:"danger",link:"",size:"small",onClick:F=>ie(t)},{default:a(()=>[...l[31]||(l[31]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(P,{modelValue:y.value,"onUpdate:modelValue":l[11]||(l[11]=t=>y.value=t),title:"环境配置",width:"600px","destroy-on-close":""},{footer:a(()=>[e(d,{onClick:l[10]||(l[10]=t=>y.value=!1)},{default:a(()=>[...l[32]||(l[32]=[i("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:se},{default:a(()=>[...l[33]||(l[33]=[i("确定",-1)])]),_:1})]),default:a(()=>[e(A,{model:u,rules:W,ref_key:"envFormRef",ref:z,"label-width":"100px"},{default:a(()=>[e(m,{label:"环境名称",prop:"name"},{default:a(()=>[e(_,{modelValue:u.name,"onUpdate:modelValue":l[5]||(l[5]=t=>u.name=t)},null,8,["modelValue"])]),_:1}),e(T,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(m,{label:"环境编码",prop:"env_code"},{default:a(()=>[e(_,{modelValue:u.env_code,"onUpdate:modelValue":l[6]||(l[6]=t=>u.env_code=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(m,{label:"环境类型",prop:"env_type"},{default:a(()=>[e(k,{modelValue:u.env_type,"onUpdate:modelValue":l[7]||(l[7]=t=>u.env_type=t),style:{width:"100%"}},{default:a(()=>[e(r,{label:"开发环境",value:"dev"}),e(r,{label:"测试环境",value:"testing"}),e(r,{label:"预发布环境",value:"staging"}),e(r,{label:"生产环境",value:"production"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{label:"基础URL",prop:"base_url"},{default:a(()=>[e(_,{modelValue:u.base_url,"onUpdate:modelValue":l[8]||(l[8]=t=>u.base_url=t),placeholder:"http://..."},null,8,["modelValue"])]),_:1}),e(m,{label:"描述",prop:"description"},{default:a(()=>[e(_,{modelValue:u.description,"onUpdate:modelValue":l[9]||(l[9]=t=>u.description=t),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(P,{modelValue:V.value,"onUpdate:modelValue":l[21]||(l[21]=t=>V.value=t),title:"资源配置",width:"700px","destroy-on-close":""},{footer:a(()=>[e(d,{onClick:l[20]||(l[20]=t=>V.value=!1)},{default:a(()=>[...l[34]||(l[34]=[i("取消",-1)])]),_:1}),e(d,{type:"primary",onClick:pe},{default:a(()=>[...l[35]||(l[35]=[i("确定",-1)])]),_:1})]),default:a(()=>[e(A,{model:o,rules:X,ref_key:"resourceFormRef",ref:O,"label-width":"100px"},{default:a(()=>[e(m,{label:"资源名称",prop:"name"},{default:a(()=>[e(_,{modelValue:o.name,"onUpdate:modelValue":l[12]||(l[12]=t=>o.name=t)},null,8,["modelValue"])]),_:1}),e(T,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(m,{label:"所属环境",prop:"environment_id"},{default:a(()=>[e(k,{modelValue:o.environment_id,"onUpdate:modelValue":l[13]||(l[13]=t=>o.environment_id=t),style:{width:"100%"}},{default:a(()=>[(U(!0),I(h,null,G(R.value,t=>(U(),H(r,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(m,{label:"资源类型",prop:"resource_type"},{default:a(()=>[e(k,{modelValue:o.resource_type,"onUpdate:modelValue":l[14]||(l[14]=t=>o.resource_type=t),style:{width:"100%"}},{default:a(()=>[e(r,{label:"服务器",value:"server"}),e(r,{label:"数据库",value:"database"}),e(r,{label:"缓存",value:"cache"}),e(r,{label:"消息队列",value:"message_queue"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(T,{gutter:20},{default:a(()=>[e(b,{span:16},{default:a(()=>[e(m,{label:"主机地址",prop:"host"},{default:a(()=>[e(_,{modelValue:o.host,"onUpdate:modelValue":l[15]||(l[15]=t=>o.host=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:8},{default:a(()=>[e(m,{label:"端口",prop:"port"},{default:a(()=>[e(ve,{modelValue:o.port,"onUpdate:modelValue":l[16]||(l[16]=t=>o.port=t),min:1,max:65535,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(T,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(m,{label:"用户名",prop:"username"},{default:a(()=>[e(_,{modelValue:o.username,"onUpdate:modelValue":l[17]||(l[17]=t=>o.username=t)},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(m,{label:"密码",prop:"password"},{default:a(()=>[e(_,{modelValue:o.password,"onUpdate:modelValue":l[18]||(l[18]=t=>o.password=t),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{label:"描述",prop:"description"},{default:a(()=>[e(_,{modelValue:o.description,"onUpdate:modelValue":l[19]||(l[19]=t=>o.description=t),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Xe=De(je,[["__scopeId","data-v-42c9c364"]]);export{Xe as default};
