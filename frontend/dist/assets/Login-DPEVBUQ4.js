import{r as _,a as F,c as k,o as m,b as t,w as s,E as U,u as A,d as S,e as b,f as K,g as M,h as $,i as j,j as D,k as h,l as d,F as J,m as O,n as G,p as H,q as x,s as P,t as L,v as Q,x as W,y as g}from"./index-vTAAATWV.js";/* empty css                *//* empty css                     */import{r as E}from"./index-BRBj6Fej.js";/* empty css                 */import{u as X}from"./tenant-CEzwzZBB.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const B={login:v=>E.post("/auth/login",v),getMyTenants:()=>E.get("/auth/tenants"),selectTenant:v=>E.post("/auth/select-tenant",{tenant_id:v})},Z={class:"login-container"},ee={class:"card-header"},te={key:1,class:"tenant-select"},se={class:"tenant-list"},ae=["onClick"],ne={class:"tenant-info"},oe={class:"tenant-details"},le={class:"tenant-name"},re={class:"tenant-code"},ie={__name:"Login",setup(v){const N=A(),T=X(),V=_(),i=_(!1),y=_(1),w=_([]),c=_(null),u=F({username:"",password:""}),R={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]};async function C(){V.value.validate(async o=>{var e,l;if(o){i.value=!0;try{const n=await B.login({username:u.username,password:u.password}),{token:p,user:f,tenants:r}=n.data;localStorage.setItem("token",p),localStorage.setItem("user",JSON.stringify(f)),w.value=r||[],T.tenantList=r||[],r&&r.length===1?await I(r[0]):r&&r.length>1?(y.value=2,i.value=!1):(g.error("没有可用的租户"),i.value=!1)}catch(n){g.error(((l=(e=n.response)==null?void 0:e.data)==null?void 0:l.message)||"登录失败"),i.value=!1}}})}async function q(){if(!c.value){g.warning("请选择租户");return}const o=w.value.find(e=>e.id===c.value);o&&await I(o)}async function I(o){var e,l;i.value=!0;try{const n=await B.selectTenant(o.id);localStorage.setItem("currentTenantId",o.id),T.currentTenant=n.data||o,g.success("登录成功"),N.push("/")}catch(n){g.error(((l=(e=n.response)==null?void 0:e.data)==null?void 0:l.message)||"选择租户失败"),i.value=!1}}return(o,e)=>{const l=H,n=$,p=M,f=D,r=K,z=U;return m(),k("div",Z,[t(z,{class:"login-card"},{header:s(()=>[d("div",ee,[t(l,{size:24},{default:s(()=>[t(x(W))]),_:1}),e[3]||(e[3]=d("span",null,"测试管理平台",-1))])]),default:s(()=>[y.value===1?(m(),S(r,{key:0,model:u,rules:R,ref_key:"formRef",ref:V},{default:s(()=>[t(p,{prop:"username"},{default:s(()=>[t(n,{modelValue:u.username,"onUpdate:modelValue":e[0]||(e[0]=a=>u.username=a),placeholder:"用户名","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),t(p,{prop:"password"},{default:s(()=>[t(n,{modelValue:u.password,"onUpdate:modelValue":e[1]||(e[1]=a=>u.password=a),type:"password",placeholder:"密码","prefix-icon":"Lock",onKeyup:j(C,["enter"])},null,8,["modelValue"])]),_:1}),t(p,null,{default:s(()=>[t(f,{type:"primary",onClick:C,loading:i.value,style:{width:"100%"}},{default:s(()=>[...e[4]||(e[4]=[h(" 下一步 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):y.value===2?(m(),k("div",te,[e[7]||(e[7]=d("div",{class:"tenant-title"},"请选择租户",-1)),d("div",se,[(m(!0),k(J,null,O(w.value,a=>(m(),k("div",{key:a.id,class:G(["tenant-item",{selected:c.value===a.id}]),onClick:de=>c.value=a.id},[d("div",ne,[t(l,{size:24,class:"tenant-icon"},{default:s(()=>[t(x(P))]),_:1}),d("div",oe,[d("div",le,L(a.name),1),d("div",re,L(a.code),1)])]),c.value===a.id?(m(),S(l,{key:0,size:20,class:"check-icon"},{default:s(()=>[t(x(Q))]),_:1})):b("",!0)],10,ae))),128))]),t(f,{type:"primary",onClick:q,loading:i.value,disabled:!c.value,style:{width:"100%","margin-top":"20px"}},{default:s(()=>[...e[5]||(e[5]=[h(" 进入系统 ",-1)])]),_:1},8,["loading","disabled"]),t(f,{onClick:e[2]||(e[2]=a=>y.value=1),style:{width:"100%","margin-top":"10px"}},{default:s(()=>[...e[6]||(e[6]=[h(" 返回 ",-1)])]),_:1})])):b("",!0)]),_:1})])}}},ve=Y(ie,[["__scopeId","data-v-4a8cd18a"]]);export{ve as default};
