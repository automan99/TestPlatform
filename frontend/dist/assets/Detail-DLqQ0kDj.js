import{r as C,B as ee,c as b,o as p,b as n,w as t,as as te,a2 as ne,A as se,u as oe,l as o,t as a,a3 as le,E as ae,e as m,aj as ie,ak as ue,k as u,$ as re,al as de,av as pe,d as h,F as ce,m as _e,aw as me,h as ve,j as fe,ax as ye,ay as ge,y as v,ap as B}from"./index-vTAAATWV.js";/* empty css               */import"./index-BRBj6Fej.js";/* empty css                 *//* empty css                *//* empty css                   *//* empty css                             *//* empty css               *//* empty css                       */import{d as x,a as he}from"./defect-pEhMI9Tv.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={class:"defect-detail-page"},ke={class:"page-title"},be={class:"section"},xe={class:"section"},Ce={class:"section"},Be={class:"section"},De={class:"section"},Se={key:0,class:"section"},Te={class:"comments"},Ve={class:"comment-header"},Ae={class:"comment-author"},Ie={class:"comment-time"},Ne={class:"comment-content"},Me={class:"comment-input"},Re={__name:"Detail",setup(je){const R=se(),D=oe(),s=C(null),w=C([]),f=C("");function j(){D.push("/defects")}function F(r){return{critical:"danger",high:"warning",medium:"primary",low:"info",trivial:"info"}[r]||"info"}function P(r){return{urgent:"danger",high:"warning",medium:"primary",low:"info"}[r]||"info"}function U(r){return{new:"info",assigned:"warning",in_progress:"primary",resolved:"success",closed:"info"}[r]||"info"}function H(r){return{new:"新建",assigned:"已分配",in_progress:"进行中",resolved:"已解决",closed:"已关闭"}[r]||r}function L(r){return{new:0,assigned:1,in_progress:2,resolved:3,closed:4}[r]||0}async function E(){var e;const r=await x.getDetail(R.params.id);s.value=r.data,w.value=((e=r.data)==null?void 0:e.comments)||[]}function $(){v.info("跳转到编辑页面")}function q(){B.prompt("请输入分配给谁","分配缺陷",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(({value:r})=>{x.assign(s.value.id,{assigned_to:r}).then(()=>{v.success("分配成功"),E()})})}function z(){B.confirm("确定要关闭这个缺陷吗？","提示",{type:"warning"}).then(()=>x.update(s.value.id,{status:"closed"})).then(()=>{v.success("已关闭"),E()})}function G(){B.confirm("确定要删除这个缺陷吗？","提示",{type:"warning"}).then(()=>x.delete(s.value.id)).then(()=>{v.success("删除成功"),D.push("/defects")})}function J(){if(!f.value.trim()){v.warning("请输入评论内容");return}he.create({defect_id:s.value.id,content:f.value,commented_by:"current_user"}).then(()=>{v.success("评论成功"),f.value="",E()})}return ee(()=>{E()}),(r,e)=>{const K=te,c=ue,_=re,O=ie,Q=de,S=pe,k=ae,W=me,X=ve,y=fe,T=le,g=ge,Y=ye,Z=ne;return p(),b("div",Ee,[n(K,{onBack:j,title:"返回"},{content:t(()=>{var i;return[o("span",ke,a((i=s.value)==null?void 0:i.title),1)]}),_:1}),n(Z,{gutter:20,style:{"margin-top":"20px"}},{default:t(()=>[n(T,{span:16},{default:t(()=>[n(k,null,{header:t(()=>[...e[1]||(e[1]=[o("span",null,"缺陷详情",-1)])]),default:t(()=>{var i,V,A,I,N;return[n(O,{column:2,border:""},{default:t(()=>[n(c,{label:"缺陷编号"},{default:t(()=>{var l;return[u(a((l=s.value)==null?void 0:l.defect_no),1)]}),_:1}),n(c,{label:"状态"},{default:t(()=>{var l;return[n(_,{type:U((l=s.value)==null?void 0:l.status)},{default:t(()=>{var d;return[u(a(H((d=s.value)==null?void 0:d.status)),1)]}),_:1},8,["type"])]}),_:1}),n(c,{label:"严重程度"},{default:t(()=>{var l;return[n(_,{type:F((l=s.value)==null?void 0:l.severity)},{default:t(()=>{var d;return[u(a((d=s.value)==null?void 0:d.severity),1)]}),_:1},8,["type"])]}),_:1}),n(c,{label:"优先级"},{default:t(()=>{var l;return[n(_,{type:P((l=s.value)==null?void 0:l.priority)},{default:t(()=>{var d;return[u(a((d=s.value)==null?void 0:d.priority),1)]}),_:1},8,["type"])]}),_:1}),n(c,{label:"报告人"},{default:t(()=>{var l;return[u(a((l=s.value)==null?void 0:l.reported_by),1)]}),_:1}),n(c,{label:"分配给"},{default:t(()=>{var l;return[u(a(((l=s.value)==null?void 0:l.assigned_to)||"未分配"),1)]}),_:1}),n(c,{label:"报告日期"},{default:t(()=>{var l;return[u(a((l=s.value)==null?void 0:l.reported_date),1)]}),_:1}),n(c,{label:"期望解决日期"},{default:t(()=>{var l;return[u(a(((l=s.value)==null?void 0:l.due_date)||"-"),1)]}),_:1})]),_:1}),n(Q),o("div",be,[e[2]||(e[2]=o("h4",null,"描述",-1)),o("p",null,a(((i=s.value)==null?void 0:i.description)||"无描述"),1)]),o("div",xe,[e[3]||(e[3]=o("h4",null,"复现步骤",-1)),o("p",null,a(((V=s.value)==null?void 0:V.reproduction_steps)||"无复现步骤"),1)]),o("div",Ce,[e[4]||(e[4]=o("h4",null,"期望行为",-1)),o("p",null,a(((A=s.value)==null?void 0:A.expected_behavior)||"无"),1)]),o("div",Be,[e[5]||(e[5]=o("h4",null,"实际行为",-1)),o("p",null,a(((I=s.value)==null?void 0:I.actual_behavior)||"无"),1)]),o("div",De,[e[6]||(e[6]=o("h4",null,"环境信息",-1)),n(S,null,{default:t(()=>{var l,d,M;return[(l=s.value)!=null&&l.environment?(p(),h(_,{key:0},{default:t(()=>[u(a(s.value.environment),1)]),_:1})):m("",!0),(d=s.value)!=null&&d.browser?(p(),h(_,{key:1},{default:t(()=>[u(a(s.value.browser),1)]),_:1})):m("",!0),(M=s.value)!=null&&M.os?(p(),h(_,{key:2},{default:t(()=>[u(a(s.value.os),1)]),_:1})):m("",!0)]}),_:1})]),(N=s.value)!=null&&N.resolution?(p(),b("div",Se,[e[7]||(e[7]=o("h4",null,"解决方案",-1)),o("p",null,a(s.value.resolution),1),s.value.resolution_version?(p(),h(_,{key:0,type:"success"},{default:t(()=>[u(a(s.value.resolution_version),1)]),_:1})):m("",!0)])):m("",!0)]}),_:1}),n(k,{style:{"margin-top":"20px"}},{header:t(()=>{var i;return[o("span",null,"评论 ("+a(((i=s.value)==null?void 0:i.comment_count)||0)+")",1)]}),default:t(()=>[o("div",Te,[(p(!0),b(ce,null,_e(w.value,i=>(p(),b("div",{key:i.id,class:"comment-item"},[o("div",Ve,[o("span",Ae,a(i.commented_by),1),o("span",Ie,a(i.created_at),1)]),o("div",Ne,a(i.content),1)]))),128)),!w.value||w.value.length===0?(p(),h(W,{key:0,description:"暂无评论"})):m("",!0)]),o("div",Me,[n(X,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=i=>f.value=i),type:"textarea",rows:3,placeholder:"输入评论内容..."},null,8,["modelValue"]),n(y,{type:"primary",onClick:J,style:{"margin-top":"12px"}},{default:t(()=>[...e[8]||(e[8]=[u("发表评论",-1)])]),_:1})])]),_:1})]),_:1}),n(T,{span:8},{default:t(()=>[n(k,null,{header:t(()=>[...e[9]||(e[9]=[o("span",null,"操作",-1)])]),default:t(()=>[n(S,{direction:"vertical",fill:"",style:{width:"100%"}},{default:t(()=>[n(y,{type:"primary",icon:"Edit",onClick:$},{default:t(()=>[...e[10]||(e[10]=[u("编辑",-1)])]),_:1}),n(y,{type:"success",icon:"User",onClick:q},{default:t(()=>[...e[11]||(e[11]=[u("分配",-1)])]),_:1}),n(y,{type:"warning",icon:"Close",onClick:z},{default:t(()=>[...e[12]||(e[12]=[u("关闭",-1)])]),_:1}),n(y,{type:"danger",icon:"Delete",onClick:G},{default:t(()=>[...e[13]||(e[13]=[u("删除",-1)])]),_:1})]),_:1})]),_:1}),n(k,{style:{"margin-top":"20px"}},{header:t(()=>[...e[14]||(e[14]=[o("span",null,"状态流程",-1)])]),default:t(()=>{var i;return[n(Y,{direction:"vertical",space:80,active:L((i=s.value)==null?void 0:i.status)},{default:t(()=>[n(g,{title:"新建",description:"缺陷已创建"}),n(g,{title:"已分配",description:"已分配处理人"}),n(g,{title:"进行中",description:"正在修复"}),n(g,{title:"已解决",description:"已修复"}),n(g,{title:"已关闭",description:"已关闭"})]),_:1},8,["active"])]}),_:1})]),_:1})]),_:1})])}}},Oe=we(Re,[["__scopeId","data-v-90d517e3"]]);export{Oe as default};
