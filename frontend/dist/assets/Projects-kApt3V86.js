import{r as C,a as $,B as oe,c as F,o as i,l as E,H as re,b as l,t as p,q as t,w as o,j as se,i as ne,h as pe,ad as ce,aB as de,d as g,a4 as ue,af as ie,a9 as me,y as v,k as c,p as _e,ag as fe,aa as L,ae as ye,aC as be,a5 as je,aD as R,$ as ge,f as ve,g as he,aE as ke,ap as Ve}from"./index-vTAAATWV.js";/* empty css                  *//* empty css                     *//* empty css                              *//* empty css                 */import{r as w}from"./index-BRBj6Fej.js";/* empty css                      *//* empty css               *//* empty css                   *//* empty css                        */import{a as Ce,u as we}from"./index-j7d3t5fE.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={getList:d=>w.get("/projects/",{params:d}),getDetail:d=>w.get(`/projects/${d}`),create:d=>w.post("/projects/",d),update:(d,e)=>w.put(`/projects/${d}`,e),delete:d=>w.delete(`/projects/${d}`),getStatistics:d=>w.get(`/projects/${d}/statistics`),switch:d=>w.post("/projects/switch",{project_id:d})},ze={class:"projects-container"},Ee={class:"page-header"},Ue={class:"search-bar"},Se={class:"project-name"},Ae={__name:"Projects",setup(d){const{t:e}=Ce(),N=we(),A=C(!1),D=C(!1),q=C([]),h=C(!1),x=C("create"),B=C(null),P=C(null),k=$({keyword:"",status:""}),y=$({page:1,per_page:10,total:0}),s=$({name:"",code:"",key:"",description:"",project_type:"web",url:"",repository:"",status:"active",owner:"",lead:"",color:"#409EFF",icon:""}),O={name:[{required:!0,message:e("project.name")+"不能为空",trigger:"blur"}],code:[{required:!0,message:e("project.code")+"不能为空",trigger:"blur"}],project_type:[{required:!0,message:"请选择项目类型",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},V=async()=>{A.value=!0;try{const n={page:y.page,per_page:y.per_page,...k},r=await U.getList(n);r.code===200&&(q.value=r.data.items,y.total=r.data.total)}catch{v.error("获取项目列表失败")}finally{A.value=!1}},z=()=>{y.page=1,V()},K=()=>{k.keyword="",k.status="",z()},W=()=>{x.value="create",I(),h.value=!0},H=n=>{x.value="edit",P.value=n.id,Object.assign(s,{name:n.name,code:n.code,key:n.key,description:n.description,project_type:n.project_type,url:n.url,repository:n.repository,status:n.status,owner:n.owner,lead:n.lead,color:n.color,icon:n.icon}),h.value=!0},G=n=>{Ve.confirm(e("project.deleteConfirm"),"提示",{confirmButtonText:e("common.confirm"),cancelButtonText:e("common.cancel"),type:"warning"}).then(async()=>{try{(await U.delete(n.id)).code===200&&(v.success(e("project.deleteSuccess")),V())}catch{v.error("删除失败")}})},J=async n=>{try{const r=await U.switch(n.id);r.code===200&&(v.success(e("project.switchSuccess")),N.setCurrentProject(r.data.project))}catch{v.error("切换项目失败")}},Q=async()=>{await B.value.validate(),D.value=!0;try{const n={...s};x.value==="create"?(await U.create(n)).code===200&&(v.success(e("project.createSuccess")),h.value=!1,V()):(await U.update(P.value,n)).code===200&&(v.success(e("project.updateSuccess")),h.value=!1,V())}catch{v.error(x.value==="create"?"创建失败":"更新失败")}finally{D.value=!1}},X=()=>{var n;I(),(n=B.value)==null||n.clearValidate()},I=()=>{Object.assign(s,{name:"",code:"",key:"",description:"",project_type:"web",url:"",repository:"",status:"active",owner:"",lead:"",color:"#409EFF",icon:""}),P.value=null};return oe(()=>{V()}),(n,r)=>{const S=_e,j=se,m=pe,_=ye,T=ce,b=je,f=ge,Y=ue,Z=ie,u=he,ee=ke,le=ve,te=me,ae=de;return i(),F("div",ze,[E("div",Ee,[E("h2",null,p(t(e)("project.title")),1),l(j,{type:"primary",onClick:W},{default:o(()=>[l(S,null,{default:o(()=>[l(t(fe))]),_:1}),c(" "+p(t(e)("common.create")),1)]),_:1})]),E("div",Ue,[l(m,{modelValue:k.keyword,"onUpdate:modelValue":r[0]||(r[0]=a=>k.keyword=a),placeholder:t(e)("common.search"),clearable:"",onClear:z,onKeyup:ne(z,["enter"]),style:{width:"300px","margin-right":"10px"}},{prefix:o(()=>[l(S,null,{default:o(()=>[l(t(L))]),_:1})]),_:1},8,["modelValue","placeholder"]),l(T,{modelValue:k.status,"onUpdate:modelValue":r[1]||(r[1]=a=>k.status=a),placeholder:t(e)("project.status"),clearable:"",onChange:z,style:{width:"150px","margin-right":"10px"}},{default:o(()=>[l(_,{label:t(e)("project.statusActive"),value:"active"},null,8,["label"]),l(_,{label:t(e)("project.statusArchived"),value:"archived"},null,8,["label"]),l(_,{label:t(e)("project.statusCompleted"),value:"completed"},null,8,["label"])]),_:1},8,["modelValue","placeholder"]),l(j,{type:"primary",onClick:z},{default:o(()=>[l(S,null,{default:o(()=>[l(t(L))]),_:1}),c(" "+p(t(e)("common.search")),1)]),_:1}),l(j,{onClick:K},{default:o(()=>[l(S,null,{default:o(()=>[l(t(be))]),_:1}),c(" "+p(t(e)("common.reset")),1)]),_:1})]),re((i(),g(Y,{data:q.value,border:"",stripe:"",style:{width:"100%"}},{default:o(()=>[l(b,{prop:"name",label:t(e)("project.name"),"min-width":"200"},{default:o(({row:a})=>[E("div",Se,[a.icon?(i(),F("span",{key:0,class:"project-icon",style:R({backgroundColor:a.color})},p(a.icon),5)):(i(),F("span",{key:1,class:"project-icon",style:R({backgroundColor:a.color})},p(a.name.charAt(0)),5)),E("span",null,p(a.name),1)])]),_:1},8,["label"]),l(b,{prop:"code",label:t(e)("project.code"),width:"120"},null,8,["label"]),l(b,{prop:"key",label:t(e)("project.key"),width:"100"},null,8,["label"]),l(b,{prop:"project_type",label:t(e)("project.projectType"),width:"120"},{default:o(({row:a})=>[a.project_type==="web"?(i(),g(f,{key:0,size:"small"},{default:o(()=>[c(p(t(e)("project.typeWeb")),1)]),_:1})):a.project_type==="mobile"?(i(),g(f,{key:1,type:"success",size:"small"},{default:o(()=>[c(p(t(e)("project.typeMobile")),1)]),_:1})):a.project_type==="api"?(i(),g(f,{key:2,type:"warning",size:"small"},{default:o(()=>[c(p(t(e)("project.typeApi")),1)]),_:1})):(i(),g(f,{key:3,type:"info",size:"small"},{default:o(()=>[c(p(t(e)("project.typeDesktop")),1)]),_:1}))]),_:1},8,["label"]),l(b,{label:t(e)("project.testCaseCount"),width:"100",align:"center"},{default:o(({row:a})=>[l(f,{type:"primary",size:"small"},{default:o(()=>[c(p(a.test_case_count||0),1)]),_:2},1024)]),_:1},8,["label"]),l(b,{label:t(e)("project.testPlanCount"),width:"100",align:"center"},{default:o(({row:a})=>[l(f,{type:"success",size:"small"},{default:o(()=>[c(p(a.test_plan_count||0),1)]),_:2},1024)]),_:1},8,["label"]),l(b,{label:t(e)("project.defectCount"),width:"100",align:"center"},{default:o(({row:a})=>[l(f,{type:"danger",size:"small"},{default:o(()=>[c(p(a.defect_count||0),1)]),_:2},1024)]),_:1},8,["label"]),l(b,{prop:"status",label:t(e)("project.status"),width:"100"},{default:o(({row:a})=>[a.status==="active"?(i(),g(f,{key:0,type:"success",size:"small"},{default:o(()=>[c(p(t(e)("project.statusActive")),1)]),_:1})):a.status==="archived"?(i(),g(f,{key:1,type:"info",size:"small"},{default:o(()=>[c(p(t(e)("project.statusArchived")),1)]),_:1})):(i(),g(f,{key:2,type:"warning",size:"small"},{default:o(()=>[c(p(t(e)("project.statusCompleted")),1)]),_:1}))]),_:1},8,["label"]),l(b,{label:t(e)("common.operation"),width:"200",fixed:"right"},{default:o(({row:a})=>[l(j,{link:"",type:"primary",size:"small",onClick:M=>J(a)},{default:o(()=>[c(p(t(e)("tenant.switch")),1)]),_:1},8,["onClick"]),l(j,{link:"",type:"primary",size:"small",onClick:M=>H(a)},{default:o(()=>[c(p(t(e)("common.edit")),1)]),_:1},8,["onClick"]),l(j,{link:"",type:"danger",size:"small",onClick:M=>G(a)},{default:o(()=>[c(p(t(e)("common.delete")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[ae,A.value]]),l(Z,{"current-page":y.page,"onUpdate:currentPage":r[2]||(r[2]=a=>y.page=a),"page-size":y.per_page,"onUpdate:pageSize":r[3]||(r[3]=a=>y.per_page=a),"page-sizes":[10,20,50,100],total:y.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:V,onCurrentChange:V,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"]),l(te,{modelValue:h.value,"onUpdate:modelValue":r[17]||(r[17]=a=>h.value=a),title:x.value==="create"?t(e)("common.create"):t(e)("common.edit"),width:"600px",onClose:X},{footer:o(()=>[l(j,{onClick:r[16]||(r[16]=a=>h.value=!1)},{default:o(()=>[c(p(t(e)("common.cancel")),1)]),_:1}),l(j,{type:"primary",loading:D.value,onClick:Q},{default:o(()=>[c(p(t(e)("common.save")),1)]),_:1},8,["loading"])]),default:o(()=>[l(le,{ref_key:"formRef",ref:B,model:s,rules:O,"label-width":"120px"},{default:o(()=>[l(u,{label:t(e)("project.name"),prop:"name"},{default:o(()=>[l(m,{modelValue:s.name,"onUpdate:modelValue":r[4]||(r[4]=a=>s.name=a),placeholder:t(e)("project.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(u,{label:t(e)("project.code"),prop:"code"},{default:o(()=>[l(m,{modelValue:s.code,"onUpdate:modelValue":r[5]||(r[5]=a=>s.code=a),placeholder:t(e)("project.code"),disabled:x.value==="edit"},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),l(u,{label:t(e)("project.key"),prop:"key"},{default:o(()=>[l(m,{modelValue:s.key,"onUpdate:modelValue":r[6]||(r[6]=a=>s.key=a),placeholder:t(e)("project.key"),maxlength:"10","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(u,{label:t(e)("project.projectType"),prop:"project_type"},{default:o(()=>[l(T,{modelValue:s.project_type,"onUpdate:modelValue":r[7]||(r[7]=a=>s.project_type=a),placeholder:t(e)("project.projectType"),style:{width:"100%"}},{default:o(()=>[l(_,{label:t(e)("project.typeWeb"),value:"web"},null,8,["label"]),l(_,{label:t(e)("project.typeMobile"),value:"mobile"},null,8,["label"]),l(_,{label:t(e)("project.typeApi"),value:"api"},null,8,["label"]),l(_,{label:t(e)("project.typeDesktop"),value:"desktop"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(u,{label:t(e)("project.description")},{default:o(()=>[l(m,{modelValue:s.description,"onUpdate:modelValue":r[8]||(r[8]=a=>s.description=a),type:"textarea",rows:3,placeholder:t(e)("project.description")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(u,{label:t(e)("project.url")},{default:o(()=>[l(m,{modelValue:s.url,"onUpdate:modelValue":r[9]||(r[9]=a=>s.url=a),placeholder:"https://example.com"},null,8,["modelValue"])]),_:1},8,["label"]),l(u,{label:t(e)("project.repository")},{default:o(()=>[l(m,{modelValue:s.repository,"onUpdate:modelValue":r[10]||(r[10]=a=>s.repository=a),placeholder:"https://github.com/user/repo"},null,8,["modelValue"])]),_:1},8,["label"]),l(u,{label:t(e)("project.status"),prop:"status"},{default:o(()=>[l(T,{modelValue:s.status,"onUpdate:modelValue":r[11]||(r[11]=a=>s.status=a),placeholder:t(e)("project.status"),style:{width:"100%"}},{default:o(()=>[l(_,{label:t(e)("project.statusActive"),value:"active"},null,8,["label"]),l(_,{label:t(e)("project.statusArchived"),value:"archived"},null,8,["label"]),l(_,{label:t(e)("project.statusCompleted"),value:"completed"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(u,{label:t(e)("project.owner")},{default:o(()=>[l(m,{modelValue:s.owner,"onUpdate:modelValue":r[12]||(r[12]=a=>s.owner=a),placeholder:t(e)("project.owner")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(u,{label:t(e)("project.lead")},{default:o(()=>[l(m,{modelValue:s.lead,"onUpdate:modelValue":r[13]||(r[13]=a=>s.lead=a),placeholder:t(e)("project.lead")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(u,{label:t(e)("project.color")},{default:o(()=>[l(ee,{modelValue:s.color,"onUpdate:modelValue":r[14]||(r[14]=a=>s.color=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(u,{label:t(e)("project.icon")},{default:o(()=>[l(m,{modelValue:s.icon,"onUpdate:modelValue":r[15]||(r[15]=a=>s.icon=a),placeholder:"例如: 图标",maxlength:"2"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Oe=xe(Ae,[["__scopeId","data-v-20322ab2"]]);export{Oe as default};
