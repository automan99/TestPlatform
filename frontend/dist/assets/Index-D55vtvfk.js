import{r as y,a as C,B as X,c as Y,o as Z,b as e,w as a,E as ee,a9 as te,u as le,l as V,h as ae,ad as oe,ae as ne,a4 as se,a5 as de,$ as re,k as r,t as I,a6 as pe,j as ue,af as ie,f as me,g as _e,a2 as fe,a3 as ce,aq as ge,ar as be,ap as ve,y as P}from"./index-vTAAATWV.js";/* empty css                  *//* empty css                     *//* empty css                  *//* empty css                             *//* empty css                 *//* empty css                   */import"./index-BRBj6Fej.js";/* empty css               *//* empty css                *//* empty css                      *//* empty css               *//* empty css                        *//* empty css                    */import{t as w}from"./test-plan-DwlkQCp9.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ve={class:"test-plan-page"},we={class:"page-header"},ke={class:"toolbar"},Ee={__name:"Index",setup(Ce){const x=le(),S=y(),c=y(!1),k=y(""),g=y(!1),z=y([]),v=C({keyword:"",status:""}),p=C({page:1,pageSize:20,total:0}),o=C({id:null,name:"",plan_no:"",build_version:"",start_date:"",end_date:"",priority:"medium",automation_enabled:!1,description:""}),B={name:[{required:!0,message:"请输入计划名称",trigger:"blur"}]};function D(n){return{draft:"info",active:"success",completed:"success",cancelled:"danger"}[n]||"info"}function h(n){return{draft:"草稿",active:"进行中",completed:"已完成",cancelled:"已取消"}[n]||n}function j(n){return n<30?"#f56c6c":n<70?"#e6a23c":"#67c23a"}async function m(){var t,s;const n=await w.getList({page:p.page,per_page:p.pageSize,...v});z.value=((t=n.data)==null?void 0:t.items)||[],p.total=((s=n.data)==null?void 0:s.total)||0}function O(){g.value=!1,k.value="新建测试计划",Object.assign(o,{id:null,name:"",plan_no:"",build_version:"",start_date:"",end_date:"",priority:"medium",automation_enabled:!1,description:""}),c.value=!0}function R(n){g.value=!0,k.value="编辑测试计划",Object.assign(o,{...n,start_date:n.start_date||"",end_date:n.end_date||""}),c.value=!0}function F(n){x.push(`/test-executions/${n.id}`)}function M(n){x.push(`/test-executions/${n.id}`)}function N(n){ve.confirm("确定要删除这个计划吗？","提示",{type:"warning"}).then(()=>{w.delete(n.id).then(()=>{P.success("删除成功"),m()})})}function q(){S.value.validate(n=>{if(n){const t={...o,start_date:o.start_date?new Date(o.start_date).toISOString().split("T")[0]:null,end_date:o.end_date?new Date(o.end_date).toISOString().split("T")[0]:null},s=g.value?w.update:w.create,_=g.value?o.id:t;s(_,g.value?t:null).then(()=>{P.success(g.value?"更新成功":"创建成功"),c.value=!1,m()})}})}return X(()=>{m()}),(n,t)=>{const s=ue,_=ae,f=ne,U=oe,u=de,L=re,A=pe,G=se,H=ie,J=ee,i=_e,b=ce,E=fe,T=ge,K=be,Q=me,W=te;return Z(),Y("div",Ve,[e(J,null,{header:a(()=>[V("div",we,[t[15]||(t[15]=V("span",null,"测试计划管理",-1)),e(s,{type:"primary",onClick:O},{default:a(()=>[...t[14]||(t[14]=[r("新建计划",-1)])]),_:1})])]),default:a(()=>[V("div",ke,[e(_,{modelValue:v.keyword,"onUpdate:modelValue":t[0]||(t[0]=l=>v.keyword=l),placeholder:"搜索计划",clearable:"",style:{width:"200px"},onChange:m},null,8,["modelValue"]),e(U,{modelValue:v.status,"onUpdate:modelValue":t[1]||(t[1]=l=>v.status=l),placeholder:"状态",clearable:"",onChange:m},{default:a(()=>[e(f,{label:"草稿",value:"draft"}),e(f,{label:"进行中",value:"active"}),e(f,{label:"已完成",value:"completed"}),e(f,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"]),t[16]||(t[16]=V("div",{style:{flex:"1"}},null,-1))]),e(G,{data:z.value,style:{width:"100%"}},{default:a(()=>[e(u,{prop:"plan_no",label:"编号",width:"120"}),e(u,{prop:"name",label:"计划名称","show-overflow-tooltip":""}),e(u,{prop:"start_date",label:"开始日期",width:"120"}),e(u,{prop:"end_date",label:"结束日期",width:"120"}),e(u,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(L,{type:D(l.status)},{default:a(()=>[r(I(h(l.status)),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"progress",label:"执行进度",width:"180"},{default:a(({row:l})=>{var d,$;return[e(A,{percentage:((d=l.progress)==null?void 0:d.progress)||0,color:j((($=l.progress)==null?void 0:$.progress)||0)},null,8,["percentage","color"])]}),_:1}),e(u,{prop:"progress",label:"用例数",width:"100"},{default:a(({row:l})=>{var d;return[r(I(((d=l.progress)==null?void 0:d.total)||0),1)]}),_:1}),e(u,{label:"操作",width:"320",fixed:"right"},{default:a(({row:l})=>[e(s,{type:"primary",link:"",size:"small",onClick:d=>F(l)},{default:a(()=>[...t[17]||(t[17]=[r("用例管理",-1)])]),_:1},8,["onClick"]),e(s,{type:"primary",link:"",size:"small",onClick:d=>R(l)},{default:a(()=>[...t[18]||(t[18]=[r("编辑",-1)])]),_:1},8,["onClick"]),e(s,{type:"success",link:"",size:"small",onClick:d=>M(l)},{default:a(()=>[...t[19]||(t[19]=[r("执行",-1)])]),_:1},8,["onClick"]),e(s,{type:"danger",link:"",size:"small",onClick:d=>N(l)},{default:a(()=>[...t[20]||(t[20]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(H,{"current-page":p.page,"onUpdate:currentPage":t[2]||(t[2]=l=>p.page=l),"page-size":p.pageSize,"onUpdate:pageSize":t[3]||(t[3]=l=>p.pageSize=l),total:p.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:m,onSizeChange:m,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),e(W,{modelValue:c.value,"onUpdate:modelValue":t[13]||(t[13]=l=>c.value=l),title:k.value,width:"600px","destroy-on-close":""},{footer:a(()=>[e(s,{onClick:t[12]||(t[12]=l=>c.value=!1)},{default:a(()=>[...t[21]||(t[21]=[r("取消",-1)])]),_:1}),e(s,{type:"primary",onClick:q},{default:a(()=>[...t[22]||(t[22]=[r("确定",-1)])]),_:1})]),default:a(()=>[e(Q,{model:o,rules:B,ref_key:"formRef",ref:S,"label-width":"100px"},{default:a(()=>[e(i,{label:"计划名称",prop:"name"},{default:a(()=>[e(_,{modelValue:o.name,"onUpdate:modelValue":t[4]||(t[4]=l=>o.name=l),placeholder:"请输入计划名称"},null,8,["modelValue"])]),_:1}),e(E,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(i,{label:"计划编号",prop:"plan_no"},{default:a(()=>[e(_,{modelValue:o.plan_no,"onUpdate:modelValue":t[5]||(t[5]=l=>o.plan_no=l),placeholder:"自动生成"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(i,{label:"测试版本",prop:"build_version"},{default:a(()=>[e(_,{modelValue:o.build_version,"onUpdate:modelValue":t[6]||(t[6]=l=>o.build_version=l),placeholder:"如: v1.0.0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(E,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(i,{label:"开始日期",prop:"start_date"},{default:a(()=>[e(T,{modelValue:o.start_date,"onUpdate:modelValue":t[7]||(t[7]=l=>o.start_date=l),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(i,{label:"结束日期",prop:"end_date"},{default:a(()=>[e(T,{modelValue:o.end_date,"onUpdate:modelValue":t[8]||(t[8]=l=>o.end_date=l),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(E,{gutter:20},{default:a(()=>[e(b,{span:12},{default:a(()=>[e(i,{label:"优先级",prop:"priority"},{default:a(()=>[e(U,{modelValue:o.priority,"onUpdate:modelValue":t[9]||(t[9]=l=>o.priority=l),style:{width:"100%"}},{default:a(()=>[e(f,{label:"高",value:"high"}),e(f,{label:"中",value:"medium"}),e(f,{label:"低",value:"low"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:a(()=>[e(i,{label:"启用自动化",prop:"automation_enabled"},{default:a(()=>[e(K,{modelValue:o.automation_enabled,"onUpdate:modelValue":t[10]||(t[10]=l=>o.automation_enabled=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{label:"描述",prop:"description"},{default:a(()=>[e(_,{modelValue:o.description,"onUpdate:modelValue":t[11]||(t[11]=l=>o.description=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ne=ye(Ee,[["__scopeId","data-v-c256b827"]]);export{Ne as default};
